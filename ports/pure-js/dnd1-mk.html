<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<script>
function ddinit()
{
	document.write('<textarea id="console" cols="80" rows="20">');
	document.write('</textarea>');
	document.write('<input id="command" name="command" type="text" size="80" onkeydown="Javascript: if (event.keyCode==13) ddcliinterpreter(this)">');
	document.write("\n");
	consoleobj = document.getElementById('console');
	//consoleobj.style.font="bold 12px courier,monospace";
	//consoleobj.style.backgroundColor='#000000';
	//consoleobj.style.color='#FFFFFF';
	consoleobj.style.lineHeight='90%';
	commandobj = document.getElementById('command');
	passthru = '';
	ddinitglobalmemory();
	ddintro();
}

function ddintro()
{
	ddwr("     RICHARD GARRIOTT DND1");
	ddwr("");
	ddwr("DO YOU NEED INSTRUCTION (Y)ES OR (N)O");
	ddwrgetinput('ddinstruction');
}

function ddinstruction(cliinput)
{
	if((cliinput == 'Y') || (cliinput == 'YES'))
	{
		//01730
		ddwr("WHO SAID YOU COULD PLAY");
		return;
	}
	else if((cliinput == 'N') || (cliinput == 'NO'))
	{
		//00380
		ddwr("(O)LD OR (N)EW GAME");
		ddwrgetinput('ddoldnewgame');
	}
	else
	{
		ddwrgetinput('ddinstruction');
	}
}

function ddoldnewgame(cliinput)
{
	if((cliinput == 'O') || (cliinput == 'OLD'))
	{
		//TODO 01770
		ddwr("NOT IMPLEMENTED YET");
		ddwr("(O)LD OR (N)EW GAME");
		ddwrgetinput('ddoldnewgame');
		return;
	}
	else if((cliinput == 'N') || (cliinput == 'NEW'))
	{
		ddwr("DUNGEON #");
		ddwrgetinput('dddungeonnumber');
		return;
	}
	else
	{
		ddwrgetinput('ddoldnewgame');
	}
}

function dddungeonnumber(cliinput)
{
	ddglobal['D'] = 99;
	if(cliinput == '0')
	{
		ddglobal['D'] = 0;
	}
	else if(cliinput == '1')
	{
		ddglobal['D'] = 1;
	}
	else
	{
		ddwrgetinput('dddungeonnumber');
	}
	if((ddglobal['D'] >= 0) && (ddglobal['D'] <= 6))
	{
		ddwr("CONTINUES RESET 1=YES,2=NO ");
		ddwrgetinput('ddcontinuereset');
	}
}

/*
line 00422
*/
function ddcontinuereset(cliinput)
{
	ddglobal['J6'] = 99;
	if(cliinput == '1')
	{
		ddglobal['J6'] = 1;
	}
	else if(cliinput == '2')
	{
		ddglobal['J6'] = 2;
	}
	else
	{
		ddwrgetinput('ddcontinuereset');
	}
	if((ddglobal['J6'] == 1) || (ddglobal['J6'] == 2))
	{
		ddwr("PLAYERS NME ");
		ddwrgetinput('ddplayersname');
	}
}

/*
line 00450
*/
function ddplayersname(cliinput)
{
	ddglobal['NS'] = 99;
	if(cliinput == 'SHAVS')
	{
		ddgeneratestats();
		ddclassification_pre();
	}
	else
	{
		//01730
		ddwr("WHO SAID YOU COULD PLAY");
		return;
	}
}

/*
line 00470
*/
function ddgeneratestats()
{
	ddglobal['C'] = Array();
	//set hit points to 0
	ddglobal['C'][0] = 0;
	for(var M = 1; M <= 7; M++)
	{
		ddglobal['C'][M] = 0;
		for(var N = 1; N <= 3; N++)
		{
			var R = ddrandom(1, 6);
			ddglobal['C'][M] = ddglobal['C'][M] + R;
		}
		if(M != 7)
		{
			ddwr(ddglobal['CS'][M]+"="+ddglobal['C'][M]);
		}
		else
		{
			ddglobal['C'][M] = ddglobal['C'][M] * 15;
		}
	}
}

/*
line 00580
*/
function ddclassification_pre()
{
	ddwr("");
	ddwr("CLASSIFICATION");
	ddwr("WHICH DO YOU WANT TO BE");
	ddwr("(F)IGHTER ,(C)LERIC ,OR (W)IZARD");
	ddwrgetinput('ddclassification');
}

/*
line 00620
*/
function ddclassification(cliinput)
{
	ddglobal['CS'][0] = '';
	if((cliinput == 'F') || (cliinput == 'FIGHTER'))
	{
		ddglobal['CS'][0] = 'FIGHTER';
		ddglobal['C'][0] = ddrandom(1, 8);
		ddbuyingweapons_pre();
	}
	else if((cliinput == 'C') || (cliinput == 'CLERIC'))
	{
		ddglobal['CS'][0] = 'CLERIC';
		ddglobal['C'][0] = ddrandom(1, 8);
		ddbuyingweapons_pre();
	}
	else if((cliinput == 'W') || (cliinput == 'WIZARD'))
	{
		ddglobal['CS'][0] = 'WIZARD';
		ddglobal['C'][0] = ddrandom(1, 8);
		ddbuyingweapons_pre();
	}
	else if(cliinput == 'NONE')
	{
		ddglobal['CS'][0] = 'NONE';
		//NONE is like reroll
		//line 00625
		ddgeneratestats();
		ddclassification_pre();
	}
	else
	{
		ddwrgetinput('ddclassification');
	}
}

/*
line 00670
*/
function ddbuyingweapons_pre()
{
	ddwr("BUYING WEAPONS");
	ddwr("NUMBER","ITEM","PRICE");
	//TODO fast or norm routine
	ddwr("(0)- STOP");
	for(var M = 1; M <= 16; M++)
	{
		ddwr("("+M+")- "+ddglobal['IS'][M]+" - "+ddglobal['P'][M]);
	}
	ddwrgetinput('ddbuyingweapons');
}

/*
line 00830
*/
function ddbuyingweapons(cliinput)
{
	//ddglobal['Y'] = cliinput;
	if(cliinput == 'L')
	{
		ddbuyingweapons_pre();
	}
	else
	{
		//this varies from the old code
		if(isNaN(cliinput))
		{
			ddwr("ENTER NUMBER 0 - 16 or L");
			ddwrgetinput('ddbuyingweapons');
		}
		else
		{
			cliinput = parseInt(cliinput);
			ddglobal['Y'] = cliinput;
			if((cliinput < 1) || (cliinput > 16))
			{
				ddgoldcount_pre();
			}
			else
			{
				ddpurchasecheck();
			}
		}
	}
}

/*
line 00890
line 00970
*/
function ddpurchasecheck()
{
	if( (ddglobal['C'][7] - ddglobal['P'][ddglobal['Y']]) < 0 )
	{
		ddwr("COSTS TOO MUCH");
		ddwr("TRY AGAIN ");
		ddwrgetinput('ddbuyingweapons');
	}
	else
	{
		if( ddglobal['CS'][0] == 'CLERIC' )
		{
			if( (ddglobal['Y'] == 4) || (ddglobal['Y'] == 8) || (ddglobal['Y'] == 9) || (ddglobal['Y'] > 10) )
			{
				ddpurchaseit();
			}
			else
			{
				ddwr("YOUR A CLERIC YOU CANT USE THAT ");
				ddwr("ENTER NUMBER 0 - 16 or L");
				ddwrgetinput('ddbuyingweapons');
			}
		}
		else if( ddglobal['CS'][0] == 'WIZARD' )
		{
			if( (ddglobal['Y'] == 3) || (ddglobal['Y'] == 8) || (ddglobal['Y'] > 10) )
			{
				ddpurchaseit(ddglobal['Y']);
			}
			else
			{
				ddwr("YOUR A WIZARD YOU CANT USE THAT ");
				ddwr("ENTER NUMBER 0 - 16 or L");
				ddwrgetinput('ddbuyingweapons');
			}
		}
		else
		{
			//fighter can buy anything
			ddpurchaseit(ddglobal['Y']);
		}
	}
}

/*
line 00920
might want to replace ddglobal['Y'] in here with Y
*/
function ddpurchaseit(Y)
{
	//reduce gold
	ddglobal['C'][7] = ddglobal['C'][7] - ddglobal['P'][ddglobal['Y']];
	ddwr("GP= "+ddglobal['C'][7]);
	//line 00830
	//keeps track of how many items have been bought
	ddglobal['X'] = ddglobal['X'] + 1;
	ddglobal['W'][ddglobal['X']] = ddglobal['Y'];
	ddwr("ENTER NUMBER 0 - 16 or L");
	ddwrgetinput('ddbuyingweapons');
}

/*
line 01000
*/
function ddgoldcount_pre()
{
	ddwr("GP= "+ddglobal['C'][7]);
	ddwr("EQ LIST (Y)ES OR (N)O");
	ddwrgetinput('ddequipmentlist');
}

/*
line 01030
*/
function ddequipmentlist(cliinput)
{
	ddglobal['QS'] = '';
	if((cliinput == "N") || (cliinput == "NO"))
	{
		ddcharactersheet();
	}
	else
	{
		for(var M = 1; M <= ddglobal['X']; M++)
		{
			if( ddglobal['W'][M] != 0 )
			{
				ddwr(ddglobal['W'][M]+" - "+ddglobal['IS'][ddglobal['W'][M]]);
			}
		}
		ddcharactersheet();
	}
}

/*
line 01090
*/
function ddcharactersheet()
{
	ddwr("YOUR CHARACTERISTICS ARE");
	ddwr(ddglobal['CS'][0]);
	//bump up hit points if 1
	if(ddglobal['C'][0] == 1)
	{
		ddglobal['C'][0] = 2;
	}
	ddwr("HIT POINTS "+ddglobal['C'][0]);
	ddloaddungeon();
}

/*
line 01415
*/
function ddloaddungeon()
{
	//we really need to have ddglobal['D'] set by now
	//might want to write a check for it here
	ddwr("LOADING DUNGEON NUM. "+ddglobal['D']);
	for(var M = 0; M <= 25; M++)
	{
		ddglobal['DA'][M] = Array();
		for(var N = 0; N <= 25; N++)
		{
			if( (ddglobal['D'] >= 0) && (ddglobal['D'] <= 6) )
			{
				if(ddglobal['D'] == 0)
				{
					ddglobal['DA'][M][N] = 0;
				}
				else
				{
					ddglobal['DA'][M][N] = ddstockdungeontile(ddglobal['FILE'][ddglobal['D']][M][N]);
				}
			}
			else
			{
				//we have a problem in that D is a number we can not use
			}
		}
	}
	//ddwr("DEBUG DISPLAY DUNGEON");
	//dddisplaydungeon(ddglobal['DA']);
	ddyeastart();
}

/*
line 01443
*/
function ddstockdungeontile(tiletypenumber)
{
	tiletypenumber = parseInt(tiletypenumber);
	var newtiletypenumber = 0;
	if(tiletypenumber != 0)
	{
		newtiletypenumber = tiletypenumber;
	}
	else if(tiletypenumber == 0)
	{
		if(  ddrandom(1,100) >= 97  )
		{
			newtiletypenumber = 7;
		}
		if(  ddrandom(1,100) >= 97  )
		{
			newtiletypenumber = 8;
		}
	}
	return newtiletypenumber;
}

/*
line 01470
*/
function ddyeastart()
{
	ddwr("");
	ddwr("");
	ddwr("");
	ddwr("WELCOME TO DUNGEON #"+ddglobal['D']);
	ddwr("");
	ddcommandlist_pre();
}

/*
line 01590
*/
function ddcommandlist_pre()
{
	ddwr("YOU ARE AT ("+ddglobal['G']+","+ddglobal['H']+")");
	ddwr("COMMANDS LIST");
	ddwr("1=MOVE  2=OPEN DOOR  3=SEARCH FOR TRAPS AND SECRET DOORS");
	ddwr("4=SWITCH WEAPON HN HAND  5=FIGHT");
	ddwr("6=LOOK AROUND  7=SAVE GAME  8=USE MAGIC  9=BUY MAGIC");
	ddwr("0=PASS  11=BUY H.P.");
	ddwr("COMMAND=");
	ddwrgetinput('ddcommandlist');
}

/*
line 01600
*/
function ddcommandlist(cliinput)
{
	//ddglobal['T'] = 999;
	if(isNaN(cliinput))
	{
		//really need to standardize number vs string in cliinterpreter
	}
	else if(cliinput == 0)
	{
		ddglobal['T'] = 0;
		//GOTO 07000
		ddmaintimeloop();
	}
	else if(cliinput == 1)
	{
		ddglobal['T'] = 1;
		//GOTO 02170
		ddmovearound_pre();
	}
	else if(cliinput == 2)
	{
		ddglobal['T'] = 2;
		//GOTO 03130
		ddopendoor_pre();
	}
	else if(cliinput == 3)
	{
		ddglobal['T'] = 3;
		//GOTO 03430
		ddsearchforsecret();
	}
	else if(cliinput == 4)
	{
		ddglobal['T'] = 4;
		//GOTO 03640
		ddequipweapon_pre();
	}
	else if(cliinput == 5)
	{
		ddglobal['T'] = 5;
		//GOTO 03750
		ddfightback();
	}
	else if(cliinput == 6)
	{
		ddglobal['T'] = 6;
		//GOTO 06390
		ddlookaround();
	}
	else if(cliinput == 7)
	{
		ddglobal['T'] = 7;
		//GOTO 06610
		ddsavegame();
	}
	else if(cliinput == 8)
	{
		ddglobal['T'] = 8;
		//GOTO 08680
		ddcastmagic();
	}
	else if(cliinput == 9)
	{
		ddglobal['T'] = 9;
		//GOTO 09980
	}
	else if(cliinput == 10)
	{
		ddglobal['T'] = 10;
		ddlookcheat();
		//GOTO 10730
	}
	else if(cliinput == 11)
	{
		ddglobal['T'] = 11;
		//GOTO 10830
	}
	else if(cliinput == 12)
	{
		ddglobal['T'] = 12;
		//GOTO 11000
	}
	else
	{
		//we have bad input data
		ddcommandlist_pre();
	}
}

/*
line 06390
*/
function ddlookaround()
{
	//REM LOOKING
	for(var M = -5; M <= 5; M++)
	{
		var linestring = '';
		for(var N = -5; N <= 5; N++)
		{
			if( (ddglobal['G'] + M) > 25 )
			{

			}
			else if( (ddglobal['G'] + M) < 0 )
			{

			}
			else if( (ddglobal['H'] + N) > 25 )
			{

			}
			else if( (ddglobal['H'] + N) < 0 )
			{

			}
			else if( (M == 0) && (N == 0) )
			{
				linestring = linestring+'9';
			}
			else
			{
				linestring = linestring+''+ddseeversusreal(M, N);
			}
		}
		ddwr(linestring);
	}
	ddmaintimeloop();
}

/*
line 06550
*/
function ddseeversusreal(lookm, lookn)
{
	var displaychar = '';
	var locg = ddglobal['G'] + lookm;
	var loch = ddglobal['H'] + lookn;
	var tiletypenumber = ddglobal['DA'][locg][loch];
	if( tiletypenumber == 0 )
	{
		displaychar = ' ';
	}
	else if( tiletypenumber == 1 )
	{
		displaychar = '*';
	}
	else if( tiletypenumber == 2)
	{
		displaychar = ' ';
	}
	else if( tiletypenumber == 3)
	{
		//secret door
		displaychar = '*';
	}
	else if( tiletypenumber == 4)
	{
		displaychar = '4';
	}
	else if( tiletypenumber == 5)
	{
		displaychar = '5';
	}
	else if( tiletypenumber == 6)
	{
		displaychar = 'O';
	}
	else if( tiletypenumber == 7)
	{
		displaychar = '8';
	}
	else if( tiletypenumber == 8)
	{
		displaychar = '8';
	}
	else
	{
		displaychar = tiletypenumber;
	}
	return displaychar;
}

/*
line 07000
Evrything comes here when a turn has passed.
*/
function ddmaintimeloop()
{

	//At the end of the loop we ask the player what to do again
	ddcommandlist_pre();
}

/*
line 02170
*/
function ddmovearound_pre()
{
	ddwr("YOU ARE AT "+ddglobal['G']+" , "+ddglobal['H']);
	ddwr("  (D)OWN  (R)IGHT  (L)EFT  OR  (U)P");
	ddwrgetinput('ddmovearound');
}

/*
line 2190
*/
function ddmovearound(cliinput)
{
	ddglobal['QS'] = '';
	ddglobal['S'] = 0;
	ddglobal['T'] = 0;
	if( (cliinput == 'R') || (cliinput == 'RIGHT') || (cliinput == 'E') || (cliinput == 'EAST' ) )
	{
		ddglobal['QS'] = 'RIGHT';
		ddglobal['S'] = 0;
		ddglobal['T'] = 1;
		ddcheckmovespot();
	}
	else if( (cliinput == 'L') || (cliinput == 'LEFT') || (cliinput == 'W') || (cliinput == 'WEST') )
	{
		ddglobal['QS'] = 'LEFT';
		ddglobal['S'] = 0;
		ddglobal['T'] = -1;
		ddcheckmovespot();
	}
	else if( (cliinput == 'U') || (cliinput == 'UP') || (cliinput == 'N') || (cliinput == 'NORTH') )
	{
		ddglobal['QS'] = 'UP';
		ddglobal['S'] = -1;
		ddglobal['T'] = 0;
		ddcheckmovespot();
	}
	else if( (cliinput == 'D') || (cliinput == 'DOWN') || (cliinput == 'S') || (cliinput == 'SOUTH') )
	{
		ddglobal['QS'] = 'DOWN';
		ddglobal['S'] = 1;
		ddglobal['T'] = 0;
		ddcheckmovespot();
	}
	else
	{
		//we have an unknown input
		ddmovearound_pre();
	}
}

/*
line 02370
02369 REM 0 = SPACE, 1 = WALL, 2 = TRAP
02369 REM 3 = SECRET, 5 = MONSTER, 6 = GOLD
02369 REM 7 = ST BONUS, 8 = IN BONUS
*/
function ddcheckmovespot()
{
	var locg = ddglobal['G'] + ddglobal['S'];
	var loch = ddglobal['H'] + ddglobal['T'];
	var tiletypenumber = ddglobal['DA'][locg][loch];
	if( tiletypenumber == 0 )
	{
		//GOTO 02430
		ddsimplemove();
	}
	else if( tiletypenumber == 1 )
	{
		//GOTO 02480
		ddwr("YOU RAN INTO A WALL");
		ddranintowall();
	}
	else if( tiletypenumber == 2 )
	{
		//GOTO 02550
		ddranintotrap();
	}
	else if( tiletypenumber == 3 )
	{
		//GOTO 02990
		ddranintosecret();
	}
	else if( tiletypenumber == 4 )
	{
		ddwr("YOU RAN INTO A DOOR");
		ddranintowall();
	}
	else if( tiletypenumber == 5 )
	{
		//GOTO 03060
		ddranintomonster();
	}
	else if( tiletypenumber == 6 )
	{
		//GOTO 02413
		ddranintogold();
	}
	else if( tiletypenumber == 7 )
	{
		//GOTO 02424
		ddincreasestr();
	}
	else if( tiletypenumber == 8 )
	{
		//GOTO 02426
		ddincreasecon();
	}
}

/*
line 02430
*/
function ddsimplemove()
{
	ddglobal['G'] = ddglobal['G'] + ddglobal['S'];
	ddglobal['H'] = ddglobal['H'] + ddglobal['T'];
	ddmaintimeloop();
}

/*
line 02480
*/
function ddranintowall()
{
	//moved message out since this is used by runintodoor
	//ddwr("YOU RAN INTO A WALL");
	if( ddrandom(1, 12) > 9 )
	{
		ddwr("AND LOOSE 1 HIT POINT");
		ddglobal['C'][0] = ddglobal['C'][0] - 1;
	}
	else
	{
		ddwr("BUT NO DAMAGE WAS INFLICTED");
	}
	ddmaintimeloop();
}

/*
line 02550
*/
function ddranintotrap()
{
	ddwr("OOOOPS A TRAP AND YOU FELL IN ");
	if( ddrandom(1, 3) > 2 )
	{
		ddwr("AND HIT POINTS LOOSE 1");
		ddglobal['C'][0] = ddglobal['C'][0] - 1;
	}
	ddwr("I HOPE YOU HAVE SOME SPIKES AND PREFERABLY ROPE");
	ddwr("LET ME SEE");
	var inventoryspike = ddcheckforspike();
	var inventoryrope = ddcheckforrope();
	if( inventoryspike != 0 )
	{
		//line 02640
		ddglobal['W'][inventoryspike] = 0;
		if( inventoryrope != 0 )
		{
			ddglobal['W'][inventoryspike] = 0;
			ddwr("GOOD BOTH");
			ddtrapescape();
		}
		else
		{
			ddnoropebutspike();
		}
	}
	else
	{
		ddnospikedead();
	}

}

/*
line 02620
*/
function ddcheckforspike()
{
	var inventorylocation = false;
	for(var M = 1; M <= ddglobal['X']; M++)
	{
		if( ddglobal['W'][M] == 12 )
		{
			inventorylocation = M;
		}
	}
	return inventorylocation;
}

/*
line 02680
*/
function ddcheckforrope()
{
	var inventorylocation = 0;
	for(var M = 1; M <= ddglobal['X']; M++)
	{
		if( ddglobal['W'][M] == 11 )
		{
			inventorylocation = M;
		}
	}
	return inventorylocation;
}

/*
02740 PRINT "NO SPIKES AH THATS TOO BAD CAUSE YOUR DEAD "
02750 STOP
*/
function ddnospikedead()
{
	ddwr("NO SPIKES AH THATS TOO BAD CAUSE YOUR DEAD ");
	ddendprogram();
}

/*
line 02890
*/
function ddnoropebutspike()
{
	ddwr("NO ROPE BUT AT LEAS SPIKES");
	if( (ddrandom(1, 3) + 1) == 2 )
	{
		//line 02960
		ddwr("OOPS H.P. LOOSE 1");
		ddglobal['C'][0] = ddglobal['C'][0] - 1;
		ddwr("TRY AGAIN ");
		//seems like a pontential bug
		//keep losing hit points in rare circumstances
		//long after character is already dead
		ddnoropebutspike();
	}
	else
	{
		ddtrapescape();
	}
}

/*
line 02770
*/
function ddtrapescape()
{
	ddwr("YOU MANAGE TO GET OUT EASY");
	ddwr("YOUR STANDING NEXT TO THE EDGE THOUGH I'D MOVE");
	//GOTO 02170
	//gets a free move to get off trap spot
	ddmovearound_pre();
}

/*
line 10740
*/
function ddlookcheat()
{
	for(var M = 0; M <= 25; M++)
	{
		var linetext = '';
		for(var N = 0; N <=25; N++)
		{
			linetext = linetext+''+ddglobal['DA'][M][N];
		}
		ddwr(linetext);
	}
	//GOTO 01590
	ddcommandlist_pre();
}

/*
line 03130
*/
function ddopendoor_pre()
{
	ddwr("DOOR (L)EFT (R)IGHT (U)P OR (D)OWN");
	ddwrgetinput('ddopendoor');
}

/*
line 03140
this code is very similar to line 2190
perhaps it can be merged
*/
function ddopendoor(cliinput)
{
	ddglobal['QS'] = '';
	ddglobal['S'] = 0;
	ddglobal['T'] = 0;
	if( (cliinput == 'R') || (cliinput == 'RIGHT') || (cliinput == 'E') || (cliinput == 'EAST' ) )
	{
		ddglobal['QS'] = 'RIGHT';
		ddglobal['S'] = 0;
		ddglobal['T'] = 1;
		ddcheckdoorspot();
	}
	else if( (cliinput == 'L') || (cliinput == 'LEFT') || (cliinput == 'W') || (cliinput == 'WEST') )
	{
		ddglobal['QS'] = 'LEFT';
		ddglobal['S'] = 0;
		ddglobal['T'] = -1;
		ddcheckdoorspot();
	}
	else if( (cliinput == 'U') || (cliinput == 'UP') || (cliinput == 'N') || (cliinput == 'NORTH') )
	{
		ddglobal['QS'] = 'UP';
		ddglobal['S'] = -1;
		ddglobal['T'] = 0;
		ddcheckdoorspot();
	}
	else if( (cliinput == 'D') || (cliinput == 'DOWN') || (cliinput == 'S') || (cliinput == 'SOUTH') )
	{
		ddglobal['QS'] = 'DOWN';
		ddglobal['S'] = 1;
		ddglobal['T'] = 0;
		ddcheckdoorspot();
	}
	else
	{
		//unknown input
		ddopendoor_pre();
	}
}

/*
line 03310
*/
function ddcheckdoorspot()
{
	var locg = ddglobal['G'] + ddglobal['S'];
	var loch = ddglobal['H'] + ddglobal['T'];
	var tiletypenumber = ddglobal['DA'][locg][loch];
	if( (tiletypenumber == 4) || (tiletypenumber == 3) )
	{
		ddwr("PUSH");
		if( ddrandom(1, 20) < ddglobal['C'][1] )
		{
			ddwr("ITS OPEN");
			ddglobal['G'] = locg;
			ddglobal['H'] = loch;
			ddwr("DONE");
			ddmaintimeloop();
		}
		else
		{
			ddwr("DIDNT BUDGE");
			ddmaintimeloop();
		}
	}
	else
	{
		ddwr("THERE IS NOT A DOOR THERE");
		ddmaintimeloop();
	}
}

/*
line 02990
*/
function ddranintosecret()
{
	//I think there is a bug in the basic program where you never
	//can find secret doors. Fixed it in js version here.
	if( ddrandom(1, 6) > 4 )
	{
		ddwr("YOU JUST RAN INTO A SECRET DOOR");
		ddwr("AND OPENED IT");
		ddglobal['G'] = ddglobal['G'] + ddglobal['S'];
		ddglobal['H'] = ddglobal['H'] + ddglobal['T'];
		ddwr("DONE");
		ddmaintimeloop();
	}
	else
	{
		ddwr();
		ddwr("YOU RAN INTO A WALL");
		ddranintowall();
	}
}

/*
line
*/
function ranintomonster()
{
	ddwr("YOU RAN INTO THE MONSTER ");
	ddwr("HE SHOVES YOU BACK")
	ddwr("");
	if( ddrandom(1, 2) == 2 )
	{
		ddmaintimeloop();
	}
	else
	{
		ddwr("YOU LOOSE 6 HIT POINT ");
		ddglobal['C'][0] = ddglobal['C'][0] - 6;
		ddmaintimeloop();
	}
}

/*
line 02413
*/
function ddranintogold()
{
	var locg = ddglobal['G'] + ddglobal['S'];
	var loch = ddglobal['H'] + ddglobal['T'];
	ddwr("AH......GOLD.......");
	ddglobal['G9'] = ddrandom(1, 500) + 10;
	ddwr(ddglobal['G9']+"PIECES");
	ddglobal['C'][7] = ddglobal['C'][7] + ddglobal['G9'];
	ddwr("GP= "+ddglobal['C'][7]);
	ddglobal['DA'][locg][loch] = 0;
	ddcheckforpoison();
	ddglobal['G'] = ddglobal['G'] + ddglobal['S'];
	ddglobal['H'] = ddglobal['H'] + ddglobal['T'];
	ddwr("DONE");
	ddmaintimeloop();

}

/*
line 02419
*/
function ddcheckforpoison()
{
	if( ddrandom(1, 100) < 20 )
	{
		ddwr("       POISON      ");
		ddglobal['C'][0] = ddglobal['C'][0] - ddrandom(1, 4);
		ddwr("HP= "+ddglobal['C'][0]);
	}
}

/*
line 02424
*/
function ddincreasestr()
{
	//the original code did not give a message
	ddwr("A STRANGE VAPOR");
	var locg = ddglobal['G'] + ddglobal['S'];
	var loch = ddglobal['H'] + ddglobal['T'];
	ddglobal['C'][1] = ddglobal['C'][1] + 1;
	ddglobal['DA'][locg][loch] = 0;
	ddcheckforpoison();
	ddglobal['G'] = ddglobal['G'] + ddglobal['S'];
	ddglobal['H'] = ddglobal['H'] + ddglobal['T'];
	ddwr("DONE");
	ddmaintimeloop();
}

/*
line 02426
*/
function ddincreasecon()
{
	//the original code did not give a message
	ddwr("A STRANGE VAPOR");
	var locg = ddglobal['G'] + ddglobal['S'];
	var loch = ddglobal['H'] + ddglobal['T'];
	ddglobal['C'][3] = ddglobal['C'][3] + 1;
	ddglobal['DA'][locg][loch] = 0;
	ddcheckforpoison();
	ddglobal['G'] = ddglobal['G'] + ddglobal['S'];
	ddglobal['H'] = ddglobal['H'] + ddglobal['T'];
	ddwr("DONE");
	ddmaintimeloop();
}

/*
03430
*/
function ddsearchforsecret()
{

	ddwr("SEARCH.........SEARCH...........SEARCH...........");
	if( ddrandom(1,40) < (ddglobal['C'][5] + ddglobal['C'][6]) )
	{
		var foundflag = 0;
		for(var M = -1; M <= 1; M++)
		{
			for(var N = -1; N <= 1; N++)
			{
				var locg = ddglobal['G'] + M;
				var loch = ddglobal['H'] + N;
				if(ddglobal['DA'][locg][loch] == 2)
				{
					foundflag = 1;
					ddwr("YES THERE IS A TRAP");
					ddwr("IT IS "+M+"VERTICALY  "+N+"HORAZONTALY FROM YOU");
					//need to look into what Z is about
					ddglobal['Z'] = 1;
				}
				else if(ddglobal['DA'][locg][loch] == 3)
				{
					foundflag = 1;
					ddwr("YES A DOOR");
					ddwr("IT IS AT "+M+"VERTICALY  "+N+"HORAZANTALY");
					//need to look into what Z is about
					ddglobal['Z'] = 1;
				}
			}
		}
		if( foundflag == 0 )
		{
			ddwr("NO NOT THAT YOU CAN TELL");
			ddmaintimeloop();
		}
	}
	else
	{
		ddwr("NO NOT THAT YOU CAN TELL");
		ddmaintimeloop();
	}
}

/*
line 03640
*/
function ddequipweapon_pre()
{
	ddwr("WHICH WEAPON WILL YOU HOLD, NUM OF WEAPON ");
	ddwrgetinput('ddequipweapon');
}

/*
line 03650
*/
function ddequipweapon(cliinput)
{
	ddglobal['Y'] = cliinput;
	if(cliinput == 0)
	{
		//i think entering 0 is suppose to leave you empty handed
		//ddwr("O.K. YOU ARE NOW HOLDING A "+ddglobal['IS'][cliinput]);
		ddwr("YOU ARE NOW EMPTY HANDED");
		ddglobal['J'] = 0;
		ddmaintimeloop();
	}
	else if( (cliinput >= 1 ) && (cliinput <= 16) )
	{
		var itemfound = null;
		for(var M = 1; M <= ddglobal['X']; M++)
		{
			if(ddglobal['W'][M] == cliinput)
			{
				itemfound = M;
			}
		}
		if(itemfound != null)
		{
			ddwr("O.K. YOU ARE NOW HOLDING A "+ddglobal['IS'][cliinput]);
			ddglobal['J'] = cliinput;
			ddmaintimeloop();
		}
		else
		{
			ddwr("SORRY YOU DONT HAVE THAT ONE");
			ddequipweapon_pre();
		}
	}
	else
	{
		//we have unknown input
		ddequipment_pre();
	}
}

/*
line 03750
*/
function ddfightback()
{
	var weaponnumber = ddglobal['J'];
	ddwr("YOUR WEAPON IS "+ddglobal['IS'][weaponnumber]);
	if( ddglobal['K'] == 0 )
	{
		//no monster to fight
		//show command list again
		ddwr("YOU ATTACK THE DARKNESS");
		ddcommandlist_pre();
	}

}

/*
line 06610
*/
function ddsavegame()
{
	//ddglobal['FILE'][7] = Array();
	var savearray = Array();

	savearray['D'] = ddglobal['D'];
	savearray['X'] = ddglobal['X'];
	savearray['J'] = ddglobal['J'];
	savearray['G'] = ddglobal['G'];
	savearray['H'] = ddglobal['H'];
	savearray['K'] = ddglobal['K'];

}

/*
line
*/
function ddcastmagic()
{
	if( ddglobal['J'] != 0 )
	{
		//lose a turn!
		ddwr("YOU CANT USE MAGIC WITH WEAPON IN HAND");
		ddmaintimeloop();
	}
	else if( (ddglobal['CS'][0] == "CLERIC") )
	{
		ddwr("CLERICAL SPELL #");
		ddwrgetinput('ddcastcleric');
	}
	else if( (ddglobal['CS'][0] == "WIZARD") )
	{
		ddwr("SPELL #");
		ddwrgetinput('ddcastwizard');
	}
	else
	{
		//lose a turn!
		ddwr("YOU CANT TSE MAGIC YOUR NOT A M.U.");
		ddmaintimeloop();
	}
}

/*
line 08760
*/
function ddcastcleric(cliinput)
{
	ddglobal['Q'] = cliinput;
	if( (cliinput >= 1) && (cliinput <= ddglobal['X1']) )
	{
		var havespellflag = null;
		for(var M = 1; M <= ddglobal['X1']; M++)
		{
			if( cliinput == ddglobal['X2'][M] )
			{
				var havespellflag = M;
			}
		}
		if( havespellflag != null )
		{
			//GOTO 08830
			dddetermineclericspelleffect();
		}
		else
		{
			//lose a turn!
			ddwr("YOU DONT HAVE THAT SPELL");
			ddmaintimeloop();
		}
	}
	else
	{
		//we have unknown input
	}
}

/*
line 08830
*/
function dddetermineclericspelleffect()
{
	ddwr("YOU CAST A CLERIC SPELL");
	ddwr("NOT IMPLEMENTED YET");
	ddmaintimeloop();
}

/*
line 09310
X3 must be the master wizard spell list count
X4 must be what the player has purchased
*/
function ddcastwizard(cliinput)
{
	ddglobal['Q'] = cliinput;
	if( (cliinput >= 1) && (cliinput <= ddglobal['X3']) )
	{
		var havespellflag = null;
		for(var M = 1; M <= ddglobal['X3']; M++)
		{
			if( cliinput == ddglobal['X4'][M] )
			{
				var havespellflag = M;
			}
		}
		if( havespellflag != null )
		{
			//GOTO 09390
			dddeterminewizardspelleffect();
		}
		else
		{
			//lose a turn!
			ddwr("YOU DONT HAVE THAT SPELL");
			ddmaintimeloop();
		}
	}
	else
	{
		//we have unknown input
	}
}

/*
line 09390
*/
function dddeterminewizardspelleffect()
{
	ddwr("YOU CAST A WIZARD SPELL");
	ddwr("NOT IMPLEMENTED YET");
	ddmaintimeloop();
}









/*
utility functions
*/

function ddwr(txtscalar)
{
	consoleobj.innerHTML = consoleobj.innerHTML + txtscalar + "\n";
	consoleobj.scrollTop = consoleobj.scrollHeight;
}

function ddwrgetinput(passfunctionname)
{
	passthru = passfunctionname;
	if(commandobj.value)
	{
		commandobj.value = '';
	}
	commandobj.focus();
}

function ddcliinterpreter(inputobj)
{
	var cliinput = '';
	if(inputobj.value)
	{
		cliinput = inputobj.value;
		cliinput = cliinput.toUpperCase();
	}
	//TODO possibly set inputobj.value to empty string
	//WHY? to prevent multiple calls
	//DANGER WIL ROBINSON
	if(passthru != '')
	{
		var execcom = passthru+'("'+cliinput+'")';
		eval(execcom);
	}
	//LATER remove eval and write out by hand for security
	if(passthru == 'ddinstruction')
	{
		//ddinstruction(cliinput);
	}
	else if(passthru == '')
	{

	}
}

/*
Does not use low right now. Will improve it if needed.
*/
function ddrandom(low, high)
{
	var randomnumber = Math.floor((Math.random() * high) + 1);
	return randomnumber;
}

/*
Throw error to end program
*/
function ddendprogram()
{
	passthru = '';
	throw new Error("Program has terminated");
}

/*
global memory
I wanted to keep the original 1 to n loops instead of adjusting them to 0.
But javascript starts counting at 0 so keep that in mind.
*/
function ddinitglobalmemory()
{
	ddglobal = Array();
	ddglobal['CS'] = Array('skip0');
	ddglobal['CS'][1] = "STR";
	ddglobal['CS'][2] = "DEX";
	ddglobal['CS'][3] = "CON";
	ddglobal['CS'][4] = "CHAR";
	ddglobal['CS'][5] = "WIS";
	ddglobal['CS'][6] = "INT";
	ddglobal['CS'][7] = "GOLD";

	ddglobal['IS'] = Array('skip0');
	ddglobal['P'] = Array('skip0');

	var itemlist = Array
	(
		"SWORD",10,"2-H-SWORD",15,"DAGGER",3,"MACE",5,
		"SPEAR",2,"BOW",25,"ARROWS",2,"LEATHER MAIL",15,
		"CHAIN MAIL",30,"TLTE MAIL",50,"ROPE",1,"SPIKES",1,
		"FLASK OF OIL",2,"SILVER CROSS",25,"SPARE FOOD",5,
		"MJOLNIR",1
	);
	//IS is item array of names
	//P is item array of prices
	for(var M = 1; M <= 16; M++)
	{
		var j = (M * 2) - 2;
		var k = j + 1;

		ddglobal['IS'][M] = itemlist[j];
		ddglobal['P'][M] = itemlist[k];
	}
	//X is count of bought items
	//W is an array of item numbers bought by character
	ddglobal['X'] = 0;
	ddglobal['W'] = Array('skip0');
	//DA is the current dungeon being played DA was just D(0,0) in the original
	ddglobal['DA'] = Array();
	//FILE replaces the file routines in the original
	//TODO change dddungeondata1 to 2, 3, 4 etc...
	ddglobal['FILE'] = Array();
	ddglobal['FILE'][0] = Array();
	ddglobal['FILE'][1] = dddungeondata1();
	ddglobal['FILE'][2] = dddungeondata2();
	ddglobal['FILE'][3] = dddungeondata1();
	ddglobal['FILE'][4] = dddungeondata1();
	ddglobal['FILE'][5] = dddungeondata1();
	ddglobal['FILE'][6] = dddungeondata1();
	//G is row location
	//H is column location
	ddglobal['G'] = ddrandom(1, 23) + 1;
	ddglobal['H'] = ddrandom(1, 23) + 1;
	//K is if there is a monster to fight or not
	ddglobal['K'] = 0;
	//FILE 7 is to save the game
	ddglobal['FILE'][7] = Array();
	//J is what weapon is in hand
	ddglobal['J'] = 0;
}

function dddungeondata1()
{
	var duarray = Array();
	var durow = Array();
	var ducol = Array();
durow[0]  = "1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1";
durow[1]  = "1,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,1,1,0,6,1,1,1,0,1";
durow[2]  = "1,0,1,1,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,1,0,0,1,0,0,1";
durow[3]  = "1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,4,6,0,1,0,0,1";
durow[4]  = "1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,0,0,1,0,0,1";
durow[5]  = "1,4,1,1,0,0,1,3,1,1,1,0,1,4,1,0,1,1,1,0,0,1,1,1,0,1";
durow[6]  = "1,0,0,0,0,0,2,0,0,0,7,0,0,0,0,0,0,0,0,1,1,1,0,1,0,1";
durow[7]  = "1,0,1,3,1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,2,1,0,1";
durow[8]  = "1,0,1,0,1,0,1,1,1,0,1,0,0,0,1,0,1,1,1,1,1,4,1,1,0,1";
durow[9]  = "1,0,1,0,1,0,0,1,0,0,1,4,1,1,1,0,1,0,0,0,0,0,1,0,0,1";
durow[10] = "1,0,1,1,0,0,0,1,0,0,1,0,1,0,1,0,1,0,1,1,0,1,4,1,1,1";
durow[11] = "1,0,1,0,1,0,0,1,0,0,1,0,1,0,1,0,1,0,0,1,0,1,0,0,0,1";
durow[12] = "1,0,1,0,1,0,1,1,1,0,1,0,1,4,1,0,1,1,1,1,4,1,0,6,6,1";
durow[13] = "1,0,0,2,3,6,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,1,0,0,0,1";
durow[14] = "1,0,1,1,1,1,1,0,1,0,1,0,1,1,1,0,1,1,1,0,0,1,1,1,3,1";
durow[15] = "1,0,1,6,1,6,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,1";
durow[16] = "1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,2,0,0,2,0,1,0,6,1";
durow[17] = "1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,1";
durow[18] = "1,0,1,0,0,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,0,1,1,1,4,1";
durow[19] = "1,0,0,0,6,0,3,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1";
durow[20] = "1,0,0,0,0,0,1,0,0,0,0,0,0,6,0,0,0,3,0,0,0,7,0,0,0,1";
durow[21] = "1,0,1,4,1,0,1,1,1,0,1,1,1,0,1,0,1,1,1,1,0,0,0,0,0,1";
durow[22] = "1,0,1,0,1,0,0,1,0,0,1,1,1,0,1,0,1,0,0,0,0,0,0,0,0,1";
durow[23] = "1,0,1,1,1,2,0,1,0,0,1,0,1,0,1,0,1,0,1,1,0,0,0,0,0,1";
durow[24] = "1,0,4,6,1,6,0,1,0,0,4,0,3,0,1,0,1,0,0,1,0,0,0,0,0,1";
durow[25] = "1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1";
	for(var M = 0; M <= 25; M++)
	{
		ducolumn = durow[M].split(',');
		duarray[M] = ducolumn;
	}
	return duarray;
}

function dddungeondata2()
{
	var duarray = Array();
	var durow = Array();
	var ducol = Array();
durow[0]  = "1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1";
durow[1]  = "1,0,1,1,1,1,1,0,1,0,1,0,1,1,1,0,1,1,0,0,7,1,1,1,0,1";
durow[2]  = "1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,1";
durow[3]  = "1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1,6,0,1,0,0,1";
durow[4]  = "1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,1";
durow[5]  = "1,0,1,0,0,0,1,0,1,1,1,0,1,0,1,0,1,1,0,0,0,1,1,1,0,1";
durow[6]  = "1,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,1,1,1,0,1,0,1";
durow[7]  = "1,0,1,0,1,0,2,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1";
durow[8]  = "1,0,1,0,1,0,1,1,1,0,1,0,0,0,1,0,1,1,1,1,0,0,1,1,0,1";
durow[9]  = "1,0,1,0,1,0,0,1,0,0,1,1,0,0,1,0,1,0,0,0,0,0,0,0,0,1";
durow[10] = "1,0,1,1,0,0,0,1,0,0,1,0,1,0,1,0,1,0,1,1,0,0,0,0,0,1";
durow[11] = "1,0,1,0,1,0,0,1,0,0,1,0,0,1,1,0,1,0,0,1,0,0,0,0,0,1";
durow[12] = "1,0,1,0,1,0,1,1,1,0,1,0,0,0,1,0,1,1,1,1,0,0,0,7,0,1";
durow[13] = "1,0,0,7,3,6,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,1";
durow[14] = "1,0,1,1,1,1,1,0,1,0,1,0,1,1,1,0,1,1,0,0,0,1,1,1,0,1";
durow[15] = "1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,1";
durow[16] = "1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1,2,0,1,0,0,1";
durow[17] = "1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,1";
durow[18] = "1,0,1,0,0,0,1,0,1,1,1,0,1,0,1,0,1,1,0,0,0,1,1,1,0,1";
durow[19] = "1,0,0,0,7,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1";
durow[20] = "1,0,0,0,0,0,1,0,0,0,0,0,0,6,0,0,0,0,0,0,0,7,0,0,0,1";
durow[21] = "1,0,1,0,1,0,1,1,1,0,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,1";
durow[22] = "1,0,1,0,1,0,0,1,0,0,1,1,0,0,1,0,1,0,0,0,0,0,0,0,0,1";
durow[23] = "1,0,1,1,0,0,0,1,0,0,1,0,1,0,1,0,1,0,1,1,0,0,0,0,0,1";
durow[24] = "1,0,1,0,1,6,0,1,0,0,1,0,0,1,1,0,1,0,0,1,0,0,0,0,0,1";
durow[25] = "1,0,1,0,1,0,1,1,1,0,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,1";
	for(var M = 0; M <= 25; M++)
	{
		ducolumn = durow[M].split(',');
		duarray[M] = ducolumn;
	}
	return duarray;
}

function dddisplaydungeon(dungeonmaparray)
{
	for(var M = 0; M <= 25; M++)
	{
		var linestring = '';
		for(var N = 0; N <= 25; N++)
		{
			linestring = linestring+''+dungeonmaparray[M][N];
		}
		ddwr(linestring);
	}
}
</script>
</head>
<body>

<script>

ddinit();
</script>

</body>